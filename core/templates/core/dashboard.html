{% extends 'core/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h2 class="text-center mb-4">Resumen del Mes {{ mes }}/{{ anio }}</h2>

<div class="row g-4">
  <div class="col-md-4">
    <div class="card border-success text-center">
      <div class="card-header bg-success text-white">Ingresos</div>
      <div class="card-body">
        <h3>â‚¬ {{ ingresos }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border-danger text-center">
      <div class="card-header bg-danger text-white">Egresos</div>
      <div class="card-body">
        <h3>â‚¬ {{ egresos }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border-primary text-center">
      <div class="card-header bg-primary text-white">Utilidad</div>
      <div class="card-body">
        <h3>â‚¬ {{ utilidad }}</h3>
      </div>
    </div>
  </div>
</div>

<div class="card mt-5 mb-4">
  <div class="card-header">ðŸ¥‡ Producto mÃ¡s vendido</div>
  <div class="card-body">
    <p><strong>{{ producto_top.producto__nombre }}</strong> con <strong>{{ producto_top.total_vendido }}</strong> unidades vendidas.</p>
  </div>
</div>

<div class="row g-4 mb-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Ventas por DÃ­a</div>
      <div class="card-body">
        <canvas id="ventasChart"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Compras por DÃ­a</div>
      <div class="card-body">
        <canvas id="comprasChart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="card mb-5">
  <div class="card-header">ðŸ“¦ Top 5 Productos MÃ¡s Vendidos</div>
  <div class="card-body">
    <canvas id="topProductosChart"></canvas>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ventasData = {
    labels: JSON.parse('{{ ventas_labels|escapejs }}'),
    datasets: [{
      label: 'Ventas (â‚¬)',
      data: JSON.parse('{{ ventas_totales|escapejs }}'),
      backgroundColor: 'rgba(25, 135, 84, 0.6)'
    }]
  };
  const comprasData = {
    labels: JSON.parse('{{ compras_labels|escapejs }}'),
    datasets: [{
      label: 'Compras (â‚¬)',
      data: JSON.parse('{{ compras_totales|escapejs }}'),
      backgroundColor: 'rgba(220, 53, 69, 0.6)'
    }]
  };
  const topProductosData = {
    labels: JSON.parse('{{ top_nombres|escapejs }}'),
    datasets: [{
      label: 'Unidades Vendidas',
      data: JSON.parse('{{ top_cantidades|escapejs }}'),
      backgroundColor: 'rgba(13, 110, 253, 0.6)'
    }]
  };
  new Chart(document.getElementById('ventasChart'), {
    type: 'bar',
    data: ventasData,
    options: { responsive: true, plugins: { legend: { display: false } } }
  });
  new Chart(document.getElementById('comprasChart'), {
    type: 'bar',
    data: comprasData,
    options: { responsive: true, plugins: { legend: { display: false } } }
  });
  new Chart(document.getElementById('topProductosChart'), {
    type: 'bar',
    data: topProductosData,
    options: {
      responsive: true,
      indexAxis: 'y',
      plugins: {
        legend: { display: false },
        tooltip: { callbacks: { label: ctx => `${ctx.parsed.x} unidades` } }
      }
    }
  });
</script>
{% endblock %}




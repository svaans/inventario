{% extends 'core/base.html' %}
{% block title %}Cargar productos{% endblock %}

{% block content %}
<h2 class="text-center mb-4">Cargar productos desde archivo Excel</h2>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
  {% endfor %}
{% endif %}

{% if vista_previa %}
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="confirmar" value="1">
    <div class="table-responsive mb-4">
      <table class="table table-bordered table-hover">
        <thead class="table-dark">
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Precio</th>
            <th>Stock actual</th>
            <th>Stock mínimo</th>
            <th>Unidad</th>
            <th>Categoría</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          {% for fila in vista_previa %}
          <tr class="{% if fila.estado == 'nuevo' %}table-success{% elif fila.estado == 'duplicado' %}table-warning{% else %}table-danger{% endif %}">
            <td>{{ fila.codigo }}</td>
            <td>{{ fila.nombre }}</td>
            <td>{{ fila.tipo }}</td>
            <td>{{ fila.precio }}</td>
            <td>{{ fila.stock_actual }}</td>
            <td>{{ fila.stock_minimo }}</td>
            <td>{{ fila.unidad_media }}</td>
            <td>{{ fila.categoria }}</td>
            <td>{{ fila.estado|title }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="text-end">
      <button type="submit" class="btn btn-primary">Confirmar importación</button>
      <a href="{% url 'cargar_productos' %}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
{% else %}
  <form method="post" enctype="multipart/form-data" class="card p-4">
    {% csrf_token %}
    <div class="mb-3">
      <label for="archivo" class="form-label">Selecciona el archivo Excel (.xlsx)</label>
      <input type="file" name="archivo" id="archivo" class="form-control" accept=".xlsx" required>
    </div>
    <div class="text-end">
      <button type="submit" class="btn btn-primary">Cargar productos</button>
    </div>
  </form>
{% endif %}
{% endblock %}

